{% extends "base.html" %}
{% block content %}
<h2>Your Cart {{ cart_number }}</h2>

<!-- Cart selector -->
<form method="get" class="mb-3">
  <label for="cart_number">Switch Cart:</label>
  <select name="cart_number" id="cart_number" onchange="this.form.submit()">
    <option value="1" {% if cart_number == 1 %}selected{% endif %}>Cart 1</option>
    <option value="2" {% if cart_number == 2 %}selected{% endif %}>Cart 2</option>
    <option value="3" {% if cart_number == 3 %}selected{% endif %}>Cart 3</option>
  </select>
</form>

{% if items %}
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Movie</th>
        <th>Quantity</th>
        <th>Subtotal</th>
        <th style="width: 120px;"></th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.movie.title }}</td>
        <td>{{ item.qty }}</td>
        <td>${{ item.subtotal }}</td>
        <td>
          <form method="post" action="{% url 'remove_from_cart' cart_number item.movie.pk %}">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-danger">Remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="d-flex justify-content-between align-items-center">
    <h4 class="mb-0">Total: ${{ total }}</h4>
    <div class="d-flex gap-2">
      <form method="post" action="{% url 'clear_cart' cart_number %}">
        {% csrf_token %}
        <button class="btn btn-outline-secondary">Clear Cart</button>
      </form>
      {% if user.is_authenticated %}
        <a href="{% url 'checkout' cart_number %}" class="btn btn-success">Checkout</a>
      {% else %}
        <a class="btn btn-primary" href="{% url 'login' %}?next={% url 'view_cart' cart_number %}">Log in to Checkout</a>
      {% endif %}
    </div>
  </div>
{% else %}
  <p class="text-muted">Your cart is empty.</p>
{% endif %}
{% endblock %}
